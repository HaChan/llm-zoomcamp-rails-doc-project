TheMessage-IDas specified by rfc822 is supposed to be a unique identifier for that individual email. That makes it an ideal tracking token for debugging and forensics, just likeX-Request-Iddoes for web request.If an inbound email does not, against the rfc822 mandate, specify a Message-ID, one will be generated using the approach fromMail::MessageIdField.MethodsCcreate_and_extract_message_id!,create_and_upload_raw_email!Eextract_message_idGgenerate_missing_message_idInstance Public methodscreate_and_extract_message_id!(source, **options)LinkCreate a newInboundEmailfrom the rawsourceof the email, which is uploaded as an Active Storage attachment calledraw_email. Before the upload, extract the Message-ID from thesourceand set it as an attribute on the newInboundEmail.Source:show|on GitHub# File actionmailbox/app/models/action_mailbox/inbound_email/message_id.rb, line 16defcreate_and_extract_message_id!(source,**options)message_checksum=OpenSSL::Digest::SHA1.hexdigest(source)message_id=extract_message_id(source)||generate_missing_message_id(message_checksum)create!raw_email:create_and_upload_raw_email!(source),message_id:message_id,message_checksum:message_checksum,**optionsrescueActiveRecord::RecordNotUniquenilendcreate_and_upload_raw_email!(source)LinkSource:show|on GitHub# File actionmailbox/app/models/action_mailbox/inbound_email/message_id.rb, line 37defcreate_and_upload_raw_email!(source)ActiveStorage::Blob.create_and_upload!io:StringIO.new(source),filename:"message.eml",content_type:"message/rfc822",service_name:ActionMailbox.storage_serviceendextract_message_id(source)LinkSource:show|on GitHub# File actionmailbox/app/models/action_mailbox/inbound_email/message_id.rb, line 27defextract_message_id(source)Mail.from_source(source).message_idrescuenilendgenerate_missing_message_id(message_checksum)LinkSource:show|on GitHub# File actionmailbox/app/models/action_mailbox/inbound_email/message_id.rb, line 31defgenerate_missing_message_id(message_checksum)Mail::MessageIdField.new("<#{message_checksum}@#{::Socket.gethostname}.mail>").message_id.tapdo|message_id|logger.warn"Message-ID couldn't be parsed or is missing. Generated a new Message-ID: #{message_id}"endend