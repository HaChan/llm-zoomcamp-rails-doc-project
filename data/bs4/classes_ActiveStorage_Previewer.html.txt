Active Storage PreviewerThis is an abstract base class for previewers, which generate images from blobs. SeeActiveStorage::Previewer::MuPDFPreviewerandActiveStorage::Previewer::VideoPreviewerfor examples of concrete subclasses.NamespaceCLASSActiveStorage::Previewer::MuPDFPreviewerCLASSActiveStorage::Previewer::PopplerPDFPreviewerCLASSActiveStorage::Previewer::VideoPreviewerMethodsAaccept?Ddownload_blob_to_tempfile,drawLloggerNnewPpreviewTtmpdirAttributes[R]blobClass Public methodsaccept?(blob)LinkImplement this method in a concrete subclass. Have it return true when given a blob from which the previewer can generate an image.Source:show|on GitHub# File activestorage/lib/active_storage/previewer.rb, line 14defself.accept?(blob)falseendnew(blob)LinkSource:show|on GitHub# File activestorage/lib/active_storage/previewer.rb, line 18definitialize(blob)@blob=blobendInstance Public methodspreview(**options)LinkOverride this method in a concrete subclass. Have it yield an attachable preview image (i.e. anything accepted byActiveStorage::Attached::One#attach). Pass the additional options to the underlying blob that is created.Source:show|on GitHub# File activestorage/lib/active_storage/previewer.rb, line 25defpreview(**options)raiseNotImplementedErrorendInstance Private methodsdownload_blob_to_tempfile(&block)LinkDownloads the blob to a tempfile on disk. Yields the tempfile.Source:show|on GitHub# File activestorage/lib/active_storage/previewer.rb, line 31defdownload_blob_to_tempfile(&block)# :doc:blob.opentmpdir:tmpdir,&blockenddraw(*argv)LinkExecutes a system command, capturing its binary output in a tempfile. Yields the tempfile.Use this method to shell out to a system library (e.g. muPDF or FFmpeg) for preview image generation. The resulting tempfile can be used as the:iovalue in an attachable Hash:def preview
  download_blob_to_tempfile do |input|
    draw "my-drawing-command", input.path, "--format", "png", "-" do |output|
      yield io: output, filename: "#{blob.filename.base}.png", content_type: "image/png"
    end
  end
endThe output tempfile is opened in the directory returned bytmpdir.Source:show|on GitHub# File activestorage/lib/active_storage/previewer.rb, line 49defdraw(*argv)# :doc:open_tempfiledo|file|instrument:preview,key:blob.keydocapture(*argv,to:file)endyieldfileendendlogger()LinkSource:show|on GitHub# File activestorage/lib/active_storage/previewer.rb, line 93deflogger# :doc:ActiveStorage.loggerendtmpdir()LinkSource:show|on GitHub# File activestorage/lib/active_storage/previewer.rb, line 97deftmpdir# :doc:Dir.tmpdirend