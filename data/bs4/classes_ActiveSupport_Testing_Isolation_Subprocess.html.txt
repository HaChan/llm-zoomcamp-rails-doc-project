MethodsRrun_in_isolationConstantsORIG_ARGV=ARGV.dup unless defined?(ORIG_ARGV)Instance Public methodsrun_in_isolation(&blk)LinkComplicated H4X to get this working in Windows / JRuby with no forking.Source:show|on GitHub# File activesupport/lib/active_support/testing/isolation.rb, line 78defrun_in_isolation(&blk)require"tempfile"ifENV["ISOLATION_TEST"]yieldtest_result=defined?(Minitest::Result)?Minitest::Result.from(self):dupFile.open(ENV["ISOLATION_OUTPUT"],"w")do|file|file.puts[Marshal.dump(test_result)].pack("m")endexit!(0)elseTempfile.open("isolation")do|tmpfile|env= {"ISOLATION_TEST"=>self.class.name,"ISOLATION_OUTPUT"=>tmpfile.path}test_opts="-n#{self.class.name}##{name}"load_path_args= []$-I.eachdo|p|load_path_args<<"-I"load_path_args<<File.expand_path(p)endchild=IO.popen([env,Gem.ruby,*load_path_args,$0,*ORIG_ARGV,test_opts])status=nilbegin_,status=Process.wait2(child.pid)rescueErrno::ECHILD# The child process may exit before we waitnilendreturnstatus,tmpfile.read.unpack1("m")endendend