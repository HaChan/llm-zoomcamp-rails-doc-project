MethodsBbuild_stackNnewAttributes[R]app[R]config[R]pathsClass Public methodsnew(app, config, paths)LinkSource:show|on GitHub# File railties/lib/rails/application/default_middleware_stack.rb, line 8definitialize(app,config,paths)@app=app@config=config@paths=pathsendInstance Public methodsbuild_stack()LinkSource:show|on GitHub# File railties/lib/rails/application/default_middleware_stack.rb, line 14defbuild_stackActionDispatch::MiddlewareStack.newdo|middleware|unlessArray(config.hosts).empty?middleware.use::ActionDispatch::HostAuthorization,config.hosts,**config.host_authorizationendifconfig.assume_sslmiddleware.use::ActionDispatch::AssumeSSLendifconfig.force_sslmiddleware.use::ActionDispatch::SSL,**config.ssl_options,ssl_default_redirect_status:config.action_dispatch.ssl_default_redirect_statusendmiddleware.use::Rack::Sendfile,config.action_dispatch.x_sendfile_headerifconfig.public_file_server.enabledheaders=config.public_file_server.headers||{}middleware.use::ActionDispatch::Static,paths["public"].first,index:config.public_file_server.index_name,headers:headersendifrack_cache=load_rack_cacherequire"action_dispatch/http/rack_cache"middleware.use::Rack::Cache,rack_cacheendifconfig.allow_concurrency==false# User has explicitly opted out of concurrent request# handling: presumably their code is not threadsafemiddleware.use::Rack::Lockendmiddleware.use::ActionDispatch::Executor,app.executormiddleware.use::ActionDispatch::ServerTimingifconfig.server_timingmiddleware.use::Rack::Runtimemiddleware.use::Rack::MethodOverrideunlessconfig.api_onlymiddleware.use::ActionDispatch::RequestId,header:config.action_dispatch.request_id_headermiddleware.use::ActionDispatch::RemoteIp,config.action_dispatch.ip_spoofing_check,config.action_dispatch.trusted_proxiesmiddleware.use::Rails::Rack::Logger,config.log_tagsmiddleware.use::ActionDispatch::ShowExceptions,show_exceptions_appmiddleware.use::ActionDispatch::DebugExceptions,app,config.debug_exception_response_formatifconfig.consider_all_requests_localmiddleware.use::ActionDispatch::ActionableExceptionsendifconfig.reloading_enabled?middleware.use::ActionDispatch::Reloader,app.reloaderendmiddleware.use::ActionDispatch::Callbacksmiddleware.use::ActionDispatch::Cookiesunlessconfig.api_onlyif!config.api_only&&config.session_storeifconfig.force_ssl&&config.ssl_options.fetch(:secure_cookies,true)&&!config.session_options.key?(:secure)config.session_options[:secure] =trueendmiddleware.useconfig.session_store,config.session_optionsendunlessconfig.api_onlymiddleware.use::ActionDispatch::Flashmiddleware.use::ActionDispatch::ContentSecurityPolicy::Middlewaremiddleware.use::ActionDispatch::PermissionsPolicy::Middlewareendmiddleware.use::Rack::Headmiddleware.use::Rack::ConditionalGetmiddleware.use::Rack::ETag,"no-cache"middleware.use::Rack::TempfileReaperunlessconfig.api_onlyifconfig.respond_to?(:active_record)ifselector_options=config.active_record.database_selectorresolver=config.active_record.database_resolvercontext=config.active_record.database_resolver_contextmiddleware.use::ActiveRecord::Middleware::DatabaseSelector,resolver,context,selector_optionsendifshard_resolver=config.active_record.shard_resolveroptions=config.active_record.shard_selector||{}middleware.use::ActiveRecord::Middleware::ShardSelector,shard_resolver,optionsendendendend