MethodsCcall,callHhandles_encoding?Ssupports_streaming?Ttranslate_locationConstantsENCODING_TAG=Regexp.new("\\A(<%#{ENCODING_FLAG}-?%>)[ \\t]*")Class Public methodscall(template, source)LinkSource:show|on GitHub# File actionview/lib/action_view/template/handlers/erb.rb, line 29defself.call(template,source)new.call(template,source)endInstance Public methodscall(template, source)LinkSource:show|on GitHub# File actionview/lib/action_view/template/handlers/erb.rb, line 61defcall(template,source)# First, convert to BINARY, so in case the encoding is# wrong, we can still find an encoding tag# (<%# encoding %>) inside the String using a regular# expressiontemplate_source=source.berb=template_source.gsub(ENCODING_TAG,"")encoding=$2erb.force_encodingvalid_encoding(source.dup,encoding)# Always make sure we return a String in the default_internalerb.encode!# Strip trailing newlines from the template if enablederb.chomp!ifstrip_trailing_newlinesoptions= {escape:(self.class.escape_ignore_list.include?template.type),trim:(self.class.erb_trim_mode=="-")
  }ifActionView::Base.annotate_rendered_view_with_filenames&&template.format==:htmloptions[:preamble] ="@output_buffer.safe_append='<!-- BEGIN #{template.short_identifier} -->';"options[:postamble] ="@output_buffer.safe_append='<!-- END #{template.short_identifier} -->';@output_buffer"endself.class.erb_implementation.new(erb,options).srcendhandles_encoding?()LinkSource:show|on GitHub# File actionview/lib/action_view/template/handlers/erb.rb, line 37defhandles_encoding?trueendsupports_streaming?()LinkSource:show|on GitHub# File actionview/lib/action_view/template/handlers/erb.rb, line 33defsupports_streaming?trueendtranslate_location(spot, backtrace_location, source)LinkTranslate an error location returned by ErrorHighlight to the correct source location inside the template.Source:show|on GitHub# File actionview/lib/action_view/template/handlers/erb.rb, line 43deftranslate_location(spot,backtrace_location,source)# Tokenize the source linetokens=::ERB::Util.tokenize(source.lines[backtrace_location.lineno-1])new_first_column=find_offset(spot[:snippet],tokens,spot[:first_column])lineno_delta=spot[:first_lineno]-backtrace_location.linenospot[:first_lineno]-=lineno_deltaspot[:last_lineno]-=lineno_deltacolumn_delta=spot[:first_column]-new_first_columnspot[:first_column]-=column_deltaspot[:last_column]-=column_deltaspot[:script_lines] =source.linesspotrescueNotImplementedError,LocationParsingErrornilend